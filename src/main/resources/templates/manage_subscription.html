<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Nursery Mitra | Manage Subscription</title>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
    <style>
        :root {
            --bg-main: #0b0e11;
            --bg-sidebar: #12171c;
            --bg-card: #1c242c;
            --accent: #28b16d;
            --danger: #e74c3c;
            --text-light: #d6e6dd;
            --border-glass: rgba(255,255,255,0.04);
            --shadow-heavy: rgba(0,0,0,0.6);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Varela Round', sans-serif;
            background: var(--bg-main);
            color: var(--text-light);
            display: flex;
            min-height: 100vh;
        }
        .sidebar {
            width: 250px;
            background: var(--bg-sidebar);
            padding: 2rem 1rem;
            position: fixed;
            height: 100%;
            border-right: 1px solid var(--border-glass);
            box-shadow: 4px 0 16px var(--shadow-heavy);
        }
        .sidebar h2 {
            font-size: 1.6rem;
            color: var(--accent);
            text-align: center;
            margin-bottom: 2.5rem;
        }
        .sidebar a {
            display: flex;
            align-items: center;
            padding: 0.8rem 1rem;
            color: var(--text-light);
            text-decoration: none;
            margin-bottom: 0.6rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .sidebar a:hover {
            background: rgba(40,177,109,0.15);
            transform: translateX(5px);
        }
        .sidebar i {
            width: 22px;
            margin-right: 10px;
        }
        .wrapper {
            margin-left: 250px;
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-main);
        }
        .wrapper.full-width {
            margin-left: 0;
        }
        .topbar {
            background: var(--bg-sidebar);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-glass);
            box-shadow: 0 4px 16px var(--shadow-heavy);
        }
        .topbar button {
            background: var(--accent);
            border: none;
            padding: 0.6rem 1rem;
            color: #fff;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .topbar button:hover {
            background: #23a761;
        }
        .content {
            padding: 2rem;
        }
        h2.page-title {
            color: var(--accent);
            margin-bottom: 1.5rem;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-card);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px var(--shadow-heavy);
        }
        th, td {
            padding: 0.9rem;
            text-align: left;
        }
        th {
            background: var(--bg-sidebar);
            color: var(--accent);
            border-bottom: 1px solid #2e3c45;
        }
        tr:nth-child(even) { background-color: #1a1f25; }
        tr:hover { background-color: #2c343b; }

        .badge {
            padding: 0.3rem 0.6rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        .badge.pending { background: #f39c12; color: #fff; }
        .badge.resolved { background: #2ecc71; color: #fff; }

        .actions button {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--accent);
            margin-right: 10px;
            transition: transform 0.2s ease;
        }
        .actions button:hover {
            transform: scale(1.2);
        }
        .actions .delete { color: var(--danger); }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background-color: rgba(0, 0, 0, 0.75);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }
        .modal-content {
            background: var(--bg-card);
            color: var(--text-light);
            padding: 2rem;
            border-radius: 12px;
            width: 500px;
            position: relative;
            box-shadow: 0 0 20px var(--shadow-heavy);
            animation: fadeIn 0.3s ease-in-out;
        }
        .close-btn {
            position: absolute;
            top: 10px; right: 15px;
            font-size: 24px;
            color: var(--danger);
            cursor: pointer;
        }
        .modal-content textarea {
            width: 100%;
            background: #111;
            color: #fff;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 10px;
            font-family: inherit;
            resize: vertical;
        }
        .resolve-btn {
            background: var(--accent);
            color: white;
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        .resolve-btn:hover {
            background: #23a761;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .toast
        {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #28b16d;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            font-size: 0.95rem;
            box-shadow: 0px 0px 12px rgba(0, 0, 0, 0.3);
            z-index: 9999;
            opacity: 1;
            transition: opacity 0.5s ease-in-out;
        }
    </style>
</head>
<body>

<div class="sidebar">
    <h2>ðŸŒ± Nursery Mitra</h2>
    <a th:href="@{/admin/dashboard}"><i class="fas fa-tachometer-alt"></i>Dashboard</a>
    <a th:href="@{/admin/users}"><i class="fas fa-users"></i>Manage Users</a>
    <a th:href="@{/admin/contacts}"><i class="fas fa-envelope"></i>Contact Queries</a>
    <a th:href="@{/admin/subscriptions}" class="active"><i class="fas fa-credit-card"></i>Manage Subscription</a>
    <a th:href="@{/logout}"><i class="fas fa-sign-out-alt"></i>Logout</a>
</div>

<div class="wrapper">
    <div class="topbar">
        <button id="menu-toggle"><i class="fas fa-bars"></i></button>
        <span>Welcome, Admin</span>
    </div>

    <div id="toast" th:if="${success}" class="toast">
        <p th:text="${success}"></p>
    </div>

    <div class="content">
        <h2 class="page-title"><i class="fas fa-credit-card"></i> Manage Subscriptions</h2>

        <table>
            <thead>
            <tr>
                <th>ID</th>
                <th>Client Name</th>
                <th>Price</th>
                <th>Duration</th>
                <th>Subscription Date</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="sub : ${subscriptionList}">
                <td th:text="${sub.id}">1</td>
                <td th:text="${sub.name}">Basic Plan</td>
                <td th:text="${sub.price} + ' â‚¹'">199 â‚¹</td>
                <td th:text="${sub.duration} + ' Days'">30 Days</td>
                <td>
          <span th:classappend="${sub.active} ? 'badge resolved' : 'badge pending'"
                th:text="${sub.active} ? 'Active' : 'Inactive'">Active</span>
                </td>
                <td th:text="${sub.createdAt}">16 Jul 2025</td>
                <td class="actions">
                    <button type="button"
                            title="Edit Plan"
                            class="view-details-btn"
                            th:data-id="${sub.id}"
                            th:data-name="${sub.name}"
                            th:data-price="${sub.price}"
                            th:data-duration="${sub.duration}">
                        <i class="fas fa-edit"></i>
                    </button>

                    <form th:action="@{'/admin/products/delete/' + ${sub.id}}" method="post" style="display:inline;">
                        <button type="submit" class="delete" title="Delete Plan"><i class="fas fa-trash-alt"></i></button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- MODAL -->
<div id="queryModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h3>Edit Subscription Plan</h3>

        <form id="resolveForm" method="post">
            <input type="hidden" name="id" id="hiddenQueryId">

            <label for="planName">Plan Name:</label><br>
            <input type="text" name="name" id="planName" required><br><br>

            <label for="price">Price (â‚¹):</label><br>
            <input type="number" name="price" id="price" required><br><br>

            <label for="duration">Duration (Days):</label><br>
            <input type="number" name="duration" id="duration" required><br><br>

            <button type="submit" class="resolve-btn">Update Plan</button>
        </form>
    </div>
</div>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        const toast = document.getElementById('toast');
        if (toast) {
            toast.style.display = "block";
            setTimeout(() => {
                toast.style.opacity = "0";
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }
    });

    document.getElementById('menu-toggle').onclick = () => {
        const sidebar = document.querySelector('.sidebar');
        const wrapper = document.querySelector('.wrapper');
        sidebar.style.display = (sidebar.style.display === 'none') ? 'block' : 'none';
        wrapper.classList.toggle('full-width');
    };

    function openModal(id, name, price, duration) {
        document.getElementById('hiddenQueryId').value = id;
        document.getElementById('planName').value = name;
        document.getElementById('price').value = price;
        document.getElementById('duration').value = duration;
        document.getElementById('resolveForm').action = '/admin/products/update/' + id;
        document.getElementById('queryModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('queryModal').style.display = 'none';
    }

    document.addEventListener("DOMContentLoaded", function () {
        const buttons = document.querySelectorAll(".view-details-btn");

        buttons.forEach(button => {
            button.addEventListener("click", function () {
                const id = this.dataset.id;
                const name = this.dataset.name;
                const price = this.dataset.price;
                const duration = this.dataset.duration;

                openModal(id, name, price, duration);
            });
        });
    });
</script>
</body>
</html>
